var list=document.getElementById("list"),addBtn=document.getElementById("addBtn"),orderListBy=document.querySelectorAll("[data-order-by]"),statusModalBtn=document.getElementById("statusModalBtn"),statusModalAlert=document.getElementById("statusModalAlert"),borrowerSelect=document.getElementById("borrowerSelect"),bookCategorySelect=document.getElementById("bookCategorySelect"),bookSelect=document.getElementById("bookSelect"),approvedBySelect=document.getElementById("approvedBySelect"),issueDateInput=document.getElementById("issueDateInput"),dueDateInput=document.getElementById("dueDateInput"),orderBy="issue_date",ascOrDesc="ASC";const numberOfDaysToAdd=7,undef=void 0;addBtn.addEventListener("click",add,!1),bookCategorySelect.addEventListener("change",e=>{fetchBooksList(e,"bookSelect",undef)},!1),list.addEventListener("click",listBtnFunction,!1);for(var i=0;i<orderListBy.length;i++)orderListBy[i].addEventListener("click",orderList,!1);function init(){document.querySelector('[data-order-by="'+orderBy+'"]').classList.add("active-ASC"),fetchBorrowersList("borrowerSelect",undef),fetchBooksList(undef,"bookSelect",undef),fetchBookCategoriesList("bookCategorySelect",undef),fetchAdminsList("approvedBySelect",undef),fetchDates(),updateList()}function fetchBorrowersList(e,t){console.log("fetching borrowers list..."),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(e).innerHTML=this.responseText,void 0!==t&&(document.getElementById(e).value=t))},xhttp.open("GET","handler.php?action=fetchBorrowersList",!0),xhttp.send()}function fetchBooksList(e,t,o){var r="";if(e){r=e;"change"==e.type&&(r=e.target.value)}console.log("fetching books list..."),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&("NA"==this.responseText?(document.getElementById(t).innerHTML="<option value=''>None</option>",document.getElementById(t).setAttribute("disabled","true")):(document.getElementById(t).innerHTML=this.responseText,void 0!==o&&(document.getElementById(t).value=o),document.getElementById(t).removeAttribute("disabled")))},xhttp.open("GET","handler.php?action=fetchBooksList&book_category_id="+r,!0),xhttp.send()}function fetchBookCategoriesList(e,t){console.log("fetching book categories list..."),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(e).innerHTML=this.responseText,void 0!==t&&(document.getElementById(e).value=t))},xhttp.open("GET","handler.php?action=fetchBookCategoriesList",!0),xhttp.send()}function fetchAdminsList(e,t){console.log("fetching admins list..."),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(e).innerHTML=this.responseText,void 0!==t&&(document.getElementById(e).value=t))},xhttp.open("GET","handler.php?action=fetchAdminsList",!0),xhttp.send()}function fetchDates(){console.log("fetching dates..."),issueDateInput.value=getTodaysDate(),dueDateInput.value=getDateAfterDays(numberOfDaysToAdd)}function updateList(){console.log("list updating..."),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(list.innerHTML=this.responseText)},xhttp.open("GET","handler.php?action=updateList&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0),xhttp.send()}function add(){console.log("adding...");var e=borrowerSelect.value,t=bookSelect.value,o=issueDateInput.value,r=dueDateInput.value,l=approvedBySelect.value;xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&("emptyFields"==this.responseText?showStatusModal("one ore more fields are empty!","alert alert-danger"):"alreadyExist"==this.responseText?showStatusModal("Already Issued!","alert alert-warning"):"queryError"==this.responseText?showStatusModal("Query Error!","alert alert-danger"):(list.innerHTML=this.responseText,showStatusModal("Successfully Approved!","alert alert-success")))},xhttp.open("POST","handler.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=add&borrowerSelectValue="+e+"&bookSelectValue="+t+"&issueDateInputValue="+o+"&dueDateInputValue="+r+"&approvedBySelectValue="+l+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc)}var clone,rowEl,borrowEl,borrowElValue,bookEl,bookElValue,categoryEl,categoryElValue,issueDateEl,issueDateElValue,dueDateEl,dueDateElValue,approveEl,approveElValue,returnDateEl,confirmEl;function listBtnFunction(e){var t=(rowEl=e.target.closest("tr")).dataset.id,o=e.target.dataset.action;if("confirm"==o){console.log("confirming...",t),returnDateEl=rowEl.querySelector('[data-column="return_date"]'),confirmEl=rowEl.querySelector('[data-column="confirm"]');var r=returnDateEl.querySelector("input").value,l=confirmEl.querySelector("select").value;""==r?showStatusModal("one ore more fields are empty!","alert alert-danger"):(xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&("queryError"==this.responseText?showStatusModal("Query Error!","alert alert-danger"):""==this.responseText?showStatusModal("Something goes wrong!","alert alert-danger"):(list.innerHTML=this.responseText,showStatusModal("Successfully Confirmed!","alert alert-success")))},xhttp.open("POST","handler.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=confirm&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&returnDateInputValue="+r+"&confirmSelectValue="+l+"&id="+t))}else if("delete"==o){console.log("deleting...",t),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&("queryError"==this.responseText?showStatusModal("Query Error!","alert alert-danger"):(list.innerHTML=this.responseText,showStatusModal("Successfully Deleted!","alert alert-success")))},confirm("Want to delete?")?(xhttp.open("POST","handler.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=delete&id="+t+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc)):console.log("Deletion is stopped!")}else if("edit"==o){var n=document.querySelector("#list tr.editing");n&&(borrowEl.innerHTML=borrowElHTML,bookEl.innerHTML=bookElHTML,categoryEl.innerHTML=categoryElHTML,approveEl.innerHTML=approveElHTML,issueDateEl.innerHTML=issueDateElHTML,dueDateEl.innerHTML=dueDateElHTML,returnDateEl.innerHTML=returnDateElHTML,confirmEl.innerHTML=confirmElHTML,console.log("canceling...",n.dataset.id),n.classList.remove("editing")),console.log("editing...",t),borrowEl=rowEl.querySelector('[data-column="borrow"]'),bookEl=rowEl.querySelector('[data-column="book"]'),categoryEl=rowEl.querySelector('[data-column="category"]'),approveEl=rowEl.querySelector('[data-column="approve"]'),issueDateEl=rowEl.querySelector('[data-column="issue_date"]'),dueDateEl=rowEl.querySelector('[data-column="due_date"]'),returnDateEl=rowEl.querySelector('[data-column="return_date"]'),confirmEl=rowEl.querySelector('[data-column="confirm"]'),borrowElValue=borrowEl.dataset.value,bookElValue=bookEl.dataset.value,categoryElValue=categoryEl.dataset.value,approveElValue=approveEl.dataset.value,issueDateElValue=issueDateEl.dataset.value,dueDateElValue=dueDateEl.dataset.value,returnDateElValue=returnDateEl.dataset.value,confirmElValue=confirmEl.dataset.value,borrowElHTML=borrowEl.innerHTML,bookElHTML=bookEl.innerHTML,categoryElHTML=categoryEl.innerHTML,approveElHTML=approveEl.innerHTML,issueDateElHTML=issueDateEl.innerHTML,dueDateElHTML=dueDateEl.innerHTML,returnDateElHTML=returnDateEl.innerHTML,confirmElHTML=confirmEl.innerHTML,rowEl.classList.add("editing"),issueDateEl.innerHTML='<input type="date" class="form-control"  value="'+issueDateElValue+'">',dueDateEl.innerHTML='<input type="date" class="form-control"  value="'+dueDateElValue+'">',borrowEl.innerHTML='<select class="custom-select my-1" id="borrowerSelectEditing"></select>',bookEl.innerHTML='<select class="custom-select my-1" id="bookSelectEditing"></select>',categoryEl.innerHTML='<select class="custom-select my-1" id="bookCategorySelectEditing"></select>',approveEl.innerHTML='<select class="custom-select my-1" id="approveBySelectEditing"></select>',returnDateEl.innerHTML='<input type="date" class="form-control"  value="'+returnDateElValue+'">',confirmEl.innerHTML='<select class="custom-select my-1" id="confirmBySelectEditing"></select>',fetchBorrowersList("borrowerSelectEditing",borrowElValue),fetchBooksList(categoryElValue,"bookSelectEditing",bookElValue),fetchBookCategoriesList("bookCategorySelectEditing",categoryElValue),fetchAdminsList("approveBySelectEditing",approveElValue),fetchAdminsList("confirmBySelectEditing",confirmElValue),borrowEl.querySelector("select").focus();var a=borrowEl.querySelector("select"),s=bookEl.querySelector("select"),i=categoryEl.querySelector("select"),u=approveEl.querySelector("select"),c=issueDateEl.querySelector("input"),d=dueDateEl.querySelector("input"),E=returnDateEl.querySelector("input"),p=confirmEl.querySelector("select");i.addEventListener("change",e=>{fetchBooksList(e,"bookSelectEditing",undef)},!1);var y=rowEl.querySelector('[data-action="cancel"'),h=rowEl.querySelector('[data-action="submit"');a.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),s.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),i.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),u.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),c.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),d.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),E.addEventListener("keyup",function(e){keyUpFunc(e,y,h)}),p.addEventListener("keyup",function(e){keyUpFunc(e,y,h)})}else if("cancel"==o)console.log("canceling...",t),borrowEl.innerHTML=borrowElHTML,bookEl.innerHTML=bookElHTML,categoryEl.innerHTML=categoryElHTML,approveEl.innerHTML=approveElHTML,issueDateEl.innerHTML=issueDateElHTML,dueDateEl.innerHTML=dueDateElHTML,returnDateEl.innerHTML=returnDateElHTML,confirmEl.innerHTML=confirmElHTML,rowEl.classList.remove("editing");else if("submit"==o){console.log("submiting...",t);var L=borrowEl.querySelector("select").value,g=bookEl.querySelector("select").value,m=approveEl.querySelector("select").value,f=issueDateEl.querySelector("input").value,T=dueDateEl.querySelector("input").value;""==g||""==f||""==T?showStatusModal("one ore more fields are empty!","alert alert-danger"):L==borrowElValue&&g==bookElValue&&m==approveElValue&&f==issueDateElValue&&T==dueDateElValue?(borrowEl.innerHTML=borrowElHTML,bookEl.innerHTML=bookElHTML,categoryEl.innerHTML=categoryElHTML,approveEl.innerHTML=approveElHTML,issueDateEl.innerHTML=issueDateElHTML,dueDateEl.innerHTML=dueDateElHTML,rowEl.classList.remove("editing"),showStatusModal("Nothing changed!","alert alert-warning")):(xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&("queryError"==this.responseText?showStatusModal("Query Error!","alert alert-danger"):(list.innerHTML=this.responseText,showStatusModal("Successfully Updated!","alert alert-success")))},xhttp.open("POST","handler.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=submit&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&borrowElValue="+L+"&bookElValue="+g+"&approveElValue="+m+"&issueDateElValue="+f+"&dueDateElValue="+T+"&id="+t))}}init();
//# sourceMappingURL=../../maps/library.min.js.map
