var selectedDateOuter=document.getElementById("selectedDateOuter"),orderByItems=document.querySelectorAll("[data-order-by]"),addBatchBtn=document.getElementById("addBatchBtn"),timetableBatchList=document.getElementById("timetableBatchList"),selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom"),editingBatchFlag=!1,orderBy="batch_name",ascOrDesc="ASC";function updateBatchList(){console.log("batch list updating..."),editingBatchFlag=!1;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},e.open("GET","batch_handler.php?action=updateBatchList&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0),e.send()}function addBatch(){if(!editingBatchFlag){console.log("adding");var e=document.getElementById("selectedBatchCode").value,t=document.getElementById("selectedBatchName").value,a=document.getElementById("selectedBatchStartDate").value,s=document.getElementById("selectedBatchEndDate").value,d=document.getElementById("selectedBatchStuents").value,c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},c.open("POST","batch_handler.php",!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send("action=addBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&batchCode="+e+"&batchName="+t+"&batchStartDate="+a+"&batchEndDate="+s+"&batchStuents="+d)}}function individualBatchEdit(e){if(e.stopPropagation(),"deleteBatch"!=e.target.id||editingBatchFlag)if("editBatch"!=e.target.id||editingBatchFlag){if("cancelBatch"==e.target.id&&editingBatchFlag){var t=e.target.dataset.classId;console.log("cancelling: "+t),updateBatchList()}else if("submitBatch"==e.target.id&&editingBatchFlag){var a=e.target.dataset.classId;console.log("submitting: "+a);var s=document.getElementById("editingDate").value,d=(p=document.getElementById("editingClass").value,b=document.getElementById("editingInstructors").value,document.getElementById("editingStartTime").value),c=document.getElementById("editingEndTime").value,n=(I=document.getElementById("editingRoom").value,new XMLHttpRequest);n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText,editingBatchFlag=!1)},n.open("POST","timetable_handler.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=submitClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+s+"&classCode="+p+"&instructorCode="+b+"&startTime="+d+"&endTime="+c+"&roomCode="+I+"&submitId="+a)}}else{var i=e.target.dataset.classId;console.log("editing: "+i),editingBatchFlag=!0;var o=document.getElementById("editClass_"+i),r=o.querySelector(".edit-date"),l=o.querySelector(".edit-class"),u=o.querySelector(".edit-instructor"),m=o.querySelector(".edit-time"),h=o.querySelector(".edit-room");o.classList.add("editing-class"),r.innerHTML='<input type="date" class="form-control" id="editingDate" value="'+r.dataset.date+'">',m.classList.add("time-picker"),m.innerHTML='<input type="time" class="form-control" id="editingStartTime" value="'+m.dataset.starttime+'"><input type="time" class="form-control" id="editingEndTime" value="'+m.dataset.endtime+'">';var B=batchData[batchTemplate].classes,g="";for(var p in B)p==l.dataset.class?g+='<option value="'+p+'" selected>'+B[p]+"</option>":g+='<option value="'+p+'">'+B[p]+"</option>";l.innerHTML='<select class="custom-select" id="editingClass">'+g+"</select>";var y=batchData[batchTemplate].instructors,v="";for(var b in y)b==u.dataset.instructor?v+='<option value="'+b+'" selected>'+y[b]+"</option>":v+='<option value="'+b+'">'+y[b]+"</option>";u.innerHTML='<select class="custom-select" id="editingInstructors">'+v+"</select>";var L=batchData[batchTemplate].rooms,E="";for(var I in L)I==h.dataset.room?E+='<option value="'+I+'" selected>'+L[I]+"</option>":E+='<option value="'+I+'">'+L[I]+"</option>";h.innerHTML='<select class="custom-select" id="editingRoom">'+E+"</select>"}else{var D=e.target.dataset.batchId;console.log("deleting: "+D);var T=new XMLHttpRequest;T.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},confirm("Want to delete?")?(T.open("POST","batch_handler.php",!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.send("action=deleteBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&deleteId="+D)):console.log("Deletion is stopped!")}}function orderClassBy(e){for(var t=orderBy,a=0;a<orderByItems.length;a++)orderByItems[a].classList.remove("active-ASC"),orderByItems[a].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateBatchList()}function init(){updateBatchList()}init(),addBatchBtn.addEventListener("click",addBatch,!1),timetableBatchList.addEventListener("click",individualBatchEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderClassBy,!1);