var selectedDateOuter=document.getElementById("selectedDateOuter"),orderByItems=document.querySelectorAll("[data-order-by]"),addBatchBtn=document.getElementById("addBatchBtn"),timetableBatchList=document.getElementById("timetableBatchList"),selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom"),editingBatchFlag=!1,orderBy="batch_start_date",ascOrDesc="ASC";function updateBatchList(){console.log("batch list updating..."),editingBatchFlag=!1;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},e.open("GET","batch_handler.php?action=updateBatchList&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0),e.send()}function addBatch(){if(!editingBatchFlag){console.log("adding");var e=document.getElementById("selectedBatchCode").value,t=document.getElementById("selectedBatchName").value,a=document.getElementById("selectedBatchStartDate").value,s=document.getElementById("selectedBatchEndDate").value,d=document.getElementById("selectedBatchStuents").value;console.log(e,t,a,s,d);var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},n.open("POST","batch_handler.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=addBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&batchCode="+e+"&batchName="+t+"&batchStartDate="+a+"&batchEndDate="+s+"&batchStuents="+d)}}function individualClassEdit(e){if(e.stopPropagation(),"deleteClass"!=e.target.id||editingBatchFlag)if("editClass"!=e.target.id||editingBatchFlag){if("cancelClass"==e.target.id&&editingBatchFlag){var t=e.target.dataset.classId;console.log("cancelling: "+t),updateBatchList()}else if("submitClass"==e.target.id&&editingBatchFlag){var a=e.target.dataset.classId;console.log("submitting: "+a);var s=document.getElementById("editingDate").value,d=(p=document.getElementById("editingClass").value,b=document.getElementById("editingInstructors").value,document.getElementById("editingStartTime").value),n=document.getElementById("editingEndTime").value,c=(E=document.getElementById("editingRoom").value,new XMLHttpRequest);c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText,editingBatchFlag=!1)},c.open("POST","timetable_handler.php",!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send("action=submitClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+s+"&classCode="+p+"&instructorCode="+b+"&startTime="+d+"&endTime="+n+"&roomCode="+E+"&submitId="+a)}}else{var i=e.target.dataset.classId;console.log("editing: "+i),editingBatchFlag=!0;var o=document.getElementById("editClass_"+i),r=o.querySelector(".edit-date"),l=o.querySelector(".edit-class"),u=o.querySelector(".edit-instructor"),m=o.querySelector(".edit-time"),g=o.querySelector(".edit-room");o.classList.add("editing-class"),r.innerHTML='<input type="date" class="form-control" id="editingDate" value="'+r.dataset.date+'">',m.classList.add("time-picker"),m.innerHTML='<input type="time" class="form-control" id="editingStartTime" value="'+m.dataset.starttime+'"><input type="time" class="form-control" id="editingEndTime" value="'+m.dataset.endtime+'">';var h=batchData[batchTemplate].classes,B="";for(var p in h)p==l.dataset.class?B+='<option value="'+p+'" selected>'+h[p]+"</option>":B+='<option value="'+p+'">'+h[p]+"</option>";l.innerHTML='<select class="custom-select" id="editingClass">'+B+"</select>";var y=batchData[batchTemplate].instructors,v="";for(var b in y)b==u.dataset.instructor?v+='<option value="'+b+'" selected>'+y[b]+"</option>":v+='<option value="'+b+'">'+y[b]+"</option>";u.innerHTML='<select class="custom-select" id="editingInstructors">'+v+"</select>";var L=batchData[batchTemplate].rooms,C="";for(var E in L)E==g.dataset.room?C+='<option value="'+E+'" selected>'+L[E]+"</option>":C+='<option value="'+E+'">'+L[E]+"</option>";g.innerHTML='<select class="custom-select" id="editingRoom">'+C+"</select>"}else{var I=e.target.dataset.classId;console.log("deleting: "+I);var T=new XMLHttpRequest;T.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},confirm("Want to delete?")?(T.open("POST","timetable_handler.php",!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.send("action=deleteClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&deleteId="+I)):console.log("Deletion is stopped!")}}function orderClassBy(e){for(var t=orderBy,a=0;a<orderByItems.length;a++)orderByItems[a].classList.remove("active-ASC"),orderByItems[a].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateBatchList()}function init(){updateBatchList()}init(),addBatchBtn.addEventListener("click",addBatch,!1),timetableBatchList.addEventListener("click",individualClassEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderClassBy,!1);