var selectedDateOuter=document.getElementById("selectedDateOuter"),orderByItems=document.querySelectorAll("[data-order-by]"),addBatchBtn=document.getElementById("addBatchBtn"),timetableBatchList=document.getElementById("timetableBatchList"),selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom"),editingClassFlag=!1,orderBy="batch_start_date",ascOrDesc="ASC";function updateBatchList(){console.log("batch list updating..."),editingClassFlag=!1;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},e.open("GET","batch_handler.php?action=updateBatchList&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0),e.send()}function addClass(){if(!editingClassFlag){console.log("adding");var e=document.getElementById("selectedDate").value,t=document.getElementById("selectedClass").value,a=document.getElementById("selectedInstructor").value,s=document.getElementById("selectedStartTime").value,d=document.getElementById("selectedEndTime").value,i=document.getElementById("selectedRoom").value,n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},n.open("POST","timetable_handler.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=addClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+e+"&classCode="+t+"&instructorCode="+a+"&startTime="+s+"&endTime="+d+"&roomCode="+i)}}function individualClassEdit(e){if(e.stopPropagation(),"deleteClass"!=e.target.id||editingClassFlag)if("editClass"!=e.target.id||editingClassFlag){if("cancelClass"==e.target.id&&editingClassFlag){var t=e.target.dataset.classId;console.log("cancelling: "+t),updateBatchList()}else if("submitClass"==e.target.id&&editingClassFlag){var a=e.target.dataset.classId;console.log("submitting: "+a);var s=document.getElementById("editingDate").value,d=(h=document.getElementById("editingClass").value,v=document.getElementById("editingInstructors").value,document.getElementById("editingStartTime").value),i=document.getElementById("editingEndTime").value,n=(T=document.getElementById("editingRoom").value,new XMLHttpRequest);n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText,editingClassFlag=!1)},n.open("POST","timetable_handler.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=submitClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+s+"&classCode="+h+"&instructorCode="+v+"&startTime="+d+"&endTime="+i+"&roomCode="+T+"&submitId="+a)}}else{var o=e.target.dataset.classId;console.log("editing: "+o),editingClassFlag=!0;var l=document.getElementById("editClass_"+o),c=l.querySelector(".edit-date"),r=l.querySelector(".edit-class"),m=l.querySelector(".edit-instructor"),u=l.querySelector(".edit-time"),g=l.querySelector(".edit-room");l.classList.add("editing-class"),c.innerHTML='<input type="date" class="form-control" id="editingDate" value="'+c.dataset.date+'">',u.classList.add("time-picker"),u.innerHTML='<input type="time" class="form-control" id="editingStartTime" value="'+u.dataset.starttime+'"><input type="time" class="form-control" id="editingEndTime" value="'+u.dataset.endtime+'">';var p=batchData[batchTemplate].classes,y="";for(var h in p)h==r.dataset.class?y+='<option value="'+h+'" selected>'+p[h]+"</option>":y+='<option value="'+h+'">'+p[h]+"</option>";r.innerHTML='<select class="custom-select" id="editingClass">'+y+"</select>";var B=batchData[batchTemplate].instructors,C="";for(var v in B)v==m.dataset.instructor?C+='<option value="'+v+'" selected>'+B[v]+"</option>":C+='<option value="'+v+'">'+B[v]+"</option>";m.innerHTML='<select class="custom-select" id="editingInstructors">'+C+"</select>";var b=batchData[batchTemplate].rooms,I="";for(var T in b)T==g.dataset.room?I+='<option value="'+T+'" selected>'+b[T]+"</option>":I+='<option value="'+T+'">'+b[T]+"</option>";g.innerHTML='<select class="custom-select" id="editingRoom">'+I+"</select>"}else{var L=e.target.dataset.classId;console.log("deleting: "+L);var E=new XMLHttpRequest;E.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},confirm("Want to delete?")?(E.open("POST","timetable_handler.php",!0),E.setRequestHeader("Content-type","application/x-www-form-urlencoded"),E.send("action=deleteClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&deleteId="+L)):console.log("Deletion is stopped!")}}function orderClassBy(e){for(var t=orderBy,a=0;a<orderByItems.length;a++)orderByItems[a].classList.remove("active-ASC"),orderByItems[a].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateBatchList()}function init(){updateBatchList()}init(),addBatchBtn.addEventListener("click",addClass,!1),timetableBatchList.addEventListener("click",individualClassEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderClassBy,!1);