var selectedDateOuter=document.getElementById("selectedDateOuter"),orderByItems=document.querySelectorAll("[data-order-by]"),addBatchBtn=document.getElementById("addBatchBtn"),timetableBatchList=document.getElementById("timetableBatchList"),selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom"),editingBatchFlag=!1,orderBy="batch_name",ascOrDesc="ASC";function updateBatchList(){console.log("batch list updating..."),editingBatchFlag=!1;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},e.open("GET","batch_handler.php?action=updateBatchList&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0),e.send()}function addBatch(){if(!editingBatchFlag){console.log("adding");var e=document.getElementById("selectedBatchCode").value,t=document.getElementById("selectedBatchName").value,a=document.getElementById("selectedBatchStartDate").value,d=document.getElementById("selectedBatchEndDate").value,n=document.getElementById("selectedBatchStuents").value,c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},c.open("POST","batch_handler.php",!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send("action=addBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&batchCode="+e+"&batchName="+t+"&batchStartDate="+a+"&batchEndDate="+d+"&batchStuents="+n)}}function individualBatchEdit(e){if(e.stopPropagation(),"deleteBatch"!=e.target.id||editingBatchFlag)if("editBatch"!=e.target.id||editingBatchFlag){if("cancelBatch"==e.target.id&&editingBatchFlag){var t=e.target.dataset.batchId;console.log("cancelling: "+t),updateBatchList()}else if("submitBatch"==e.target.id&&editingBatchFlag){var a=e.target.dataset.batchId;console.log("submitting: "+a);var d=document.getElementById("editingCode").value,n=document.getElementById("editingName").value,c=document.getElementById("editingStartDate").value,s=document.getElementById("editingEndDate").value,i=document.getElementById("editingStudents").value,r=new XMLHttpRequest;r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText,editingBatchFlag=!1)},r.open("POST","batch_handler.php",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send("action=submitBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&batchCode="+d+"&batchName="+n+"&batchStartDate="+c+"&batchEndDate="+s+"&batchStuents="+i+"&submitId="+a)}}else{var o=e.target.dataset.batchId;console.log("editing: "+o),editingBatchFlag=!0;var l=document.getElementById("editBatch_"+o),h=l.querySelector(".edit-batch-code"),u=l.querySelector(".edit-batch-name"),B=l.querySelector(".edit-batch-start-date"),g=l.querySelector(".edit-batch-end-date"),m=l.querySelector(".edit-batch-students");l.classList.add("editing-class"),h.innerHTML='<input type="text" class="form-control" id="editingCode" value="'+h.dataset.batchCode+'">',u.innerHTML='<input type="text" class="form-control" id="editingName" value="'+u.dataset.batchName+'">',B.innerHTML='<input type="date" class="form-control" id="editingStartDate" value="'+B.dataset.batchStartDate+'">',g.innerHTML='<input type="date" class="form-control" id="editingEndDate" value="'+g.dataset.batchEndDate+'">',m.innerHTML='<input type="number" class="form-control" id="editingStudents" value="'+m.dataset.batchStudents+'">'}else{var y=e.target.dataset.batchId;console.log("deleting: "+y);var p=new XMLHttpRequest;p.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableBatchList.innerHTML=this.responseText)},confirm("Want to delete?")?(p.open("POST","batch_handler.php",!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),p.send("action=deleteBatch&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&deleteId="+y)):console.log("Deletion is stopped!")}}function orderClassBy(e){for(var t=orderBy,a=0;a<orderByItems.length;a++)orderByItems[a].classList.remove("active-ASC"),orderByItems[a].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateBatchList()}function init(){updateBatchList()}init(),addBatchBtn.addEventListener("click",addBatch,!1),timetableBatchList.addEventListener("click",individualBatchEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderClassBy,!1);