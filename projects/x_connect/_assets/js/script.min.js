var xhttp=new XMLHttpRequest,timetableOuter=document.getElementById("timetableOuter"),selectedDateOuter=document.getElementById("selectedDateOuter"),selectedBatchOuter=document.getElementById("selectedBatchOuter"),selectedBatch=document.getElementById("selectedBatch"),selectedLayout=document.getElementById("selectedLayout"),addClassBtn=document.getElementById("addClassBtn"),deleteClassBtn=document.getElementById("deleteClass"),timetableResult=document.getElementById("timetableResult"),batchCode=null,layout="list",batchTemplate=null,selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom");function currentDate(){var e,t=(e=new Date).getDate(),a=e.getMonth()+1;return t=(t<10?"0":"")+t,e=e.getFullYear()+"-"+(a=(a<10?"0":"")+a)+"-"+t}function updateTimeTable(e){batchCode=e.target?e.target.value:selectedBatch.value,batchTemplate=document.querySelector("[value='"+batchCode+"']").dataset.template;var t=batchData[batchTemplate].classes,a="";for(var l in t)a+='<option value="'+l+'">'+t[l]+"</option>";selectedClassEl.innerHTML=a;var d=batchData[batchTemplate].instructors,s="";for(var n in d)s+='<option value="'+n+'">'+d[n]+"</option>";selectedInstructorEL.innerHTML=s;var c=batchData[batchTemplate].rooms,o="";for(var u in c)o+='<option value="'+u+'">'+c[u]+"</option>";selectedRoomEL.innerHTML=o,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResult.innerHTML=this.responseText)},xhttp.open("GET","handler_timetable.php?action=updateTimeTable&batchCode="+batchCode+"&batchTemplate="+batchTemplate,!0),xhttp.send()}function addClass(){console.log("adding");var e=document.getElementById("selectedDate").value,t=document.getElementById("selectedClass").value,a=document.getElementById("selectedInstructor").value,l=document.getElementById("selectedStartTime").value,d=document.getElementById("selectedEndTime").value,s=document.getElementById("selectedRoom").value;console.log(batchCode,batchTemplate,e,t,a,l,d,s),xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResult.innerHTML=this.responseText)},xhttp.open("POST","handler_timetable.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=addClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&date="+e+"&classCode="+t+"&instructorCode="+a+"&startTime="+l+"&endTime="+d+"&roomCode="+s)}function deleteClass(e){if(e.stopPropagation(),"deleteClass"==e.target.id){var t=e.target.dataset.classId;console.log("deleting: "+t),xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResult.innerHTML=this.responseText)},confirm("Want to delete?")?(xhttp.open("POST","handler_timetable.php",!0),xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhttp.send("action=deleteClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&deleteId="+t)):console.log("Deletion is stopped!")}else(e.target.id="editClass")&&console.log("editing: "+e.target.dataset.classId)}function updateLayout(e){"list"==(layout=e.target?e.target.value:selectedLayout.value)?(timetableOuter.classList.add("list"),timetableOuter.classList.remove("grid")):(timetableOuter.classList.add("grid"),timetableOuter.classList.remove("list"))}function init(){updateTimeTable(selectedBatch),updateLayout(selectedLayout),selectedDate.value=currentDate(),filterStartDate.value=currentDate(),filterEndDate.value=currentDate()}init(),selectedBatch.addEventListener("change",updateTimeTable,!1),selectedLayout.addEventListener("change",updateLayout,!1),addClassBtn.addEventListener("click",addClass,!1),timetableResult.addEventListener("click",deleteClass,!1);