var timetableOuter=document.getElementById("timetableOuter"),selectedDateOuter=document.getElementById("selectedDateOuter"),selectedBatchOuter=document.getElementById("selectedBatchOuter"),filterStartDate=document.getElementById("filterStartDate"),filterEndDate=document.getElementById("filterEndDate"),selectedBatch=document.getElementById("selectedBatch"),selectedLayout=document.getElementById("selectedLayout"),addClassBtn=document.getElementById("addClassBtn"),timetableResultList=document.getElementById("timetableResultList"),timetableResultGrid=document.getElementById("timetableResultGrid"),selectedClassEl=document.getElementById("selectedClass"),selectedInstructorEL=document.getElementById("selectedInstructor"),selectedRoomEL=document.getElementById("selectedRoom"),editingClassFlag=!1,batchCode=null,batchTemplate=null,layout="list",orderBy="date";function currentDate(){var e,t=(e=new Date).getDate(),a=e.getMonth()+1;return t=(t<10?"0":"")+t,e=e.getFullYear()+"-"+(a=(a<10?"0":"")+a)+"-"+t}function updateTimeTableList(){console.log("list updating..."),batchCode=selectedBatch.value,batchTemplate=document.querySelector("[value='"+batchCode+"']").dataset.template;var e=batchData[batchTemplate].classes,t="";for(var a in e)t+='<option value="'+a+'">'+e[a]+"</option>";selectedClassEl.innerHTML=t;var l=batchData[batchTemplate].instructors,s="";for(var d in l)s+='<option value="'+d+'">'+l[d]+"</option>";selectedInstructorEL.innerHTML=s;var n=batchData[batchTemplate].rooms,i="";for(var o in n)i+='<option value="'+o+'">'+n[o]+"</option>";selectedRoomEL.innerHTML=i;var r=new XMLHttpRequest;r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResultList.innerHTML=this.responseText)},r.open("GET","handler_timetable.php?action=updateTimeTableList&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy,!0),r.send()}function updateTimeTableGrid(){console.log("grid updating...");var e=document.getElementById("filterStartDate").value,t=document.getElementById("filterEndDate").value,a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResultGrid.innerHTML=this.responseText)},a.open("GET","handler_timetable.php?action=updateTimeTableGrid&filterStartDate="+e+"&filterEndDate="+t,!0),a.send()}function addClass(){if(!editingClassFlag){console.log("adding");var e=document.getElementById("selectedDate").value,t=document.getElementById("selectedClass").value,a=document.getElementById("selectedInstructor").value,l=document.getElementById("selectedStartTime").value,s=document.getElementById("selectedEndTime").value,d=document.getElementById("selectedRoom").value,n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResultList.innerHTML=this.responseText)},n.open("POST","handler_timetable.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=addClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&date="+e+"&classCode="+t+"&instructorCode="+a+"&startTime="+l+"&endTime="+s+"&roomCode="+d)}}function individualClassEdit(e){e.stopPropagation();var t=e.target.dataset.classId;if("deleteClass"!=e.target.id||editingClassFlag)if("editClass"!=e.target.id||editingClassFlag)"cancelEditingClass"==e.target.id&&editingClassFlag&&(console.log("cancelling: "+t),updateTimeTableList(),editingClassFlag=!1);else{console.log("editing: "+t),editingClassFlag=!0;var a=document.getElementById("editClass_"+t),l=a.querySelector(".edit-date"),s=a.querySelector(".edit-class"),d=a.querySelector(".edit-instructor"),n=a.querySelector(".edit-time"),i=a.querySelector(".edit-room");a.classList.add("editing-class"),l.innerHTML='<input type="date" class="form-control" id="editingDate" value="2018-03-09">',n.classList.add("time-picker"),n.innerHTML='<input type="time" class="form-control" id="editingStartTime" value="09:00"><input type="time" class="form-control" id="editingEndTime" value="11:00">';var o=batchData[batchTemplate].classes,r="";for(var c in o)r+='<option value="'+c+'">'+o[c]+"</option>";s.innerHTML='<select class="custom-select" id="editingClass">'+r+"</select>";var u=batchData[batchTemplate].instructors,m="";for(var g in u)m+='<option value="'+g+'">'+u[g]+"</option>";d.innerHTML='<select class="custom-select" id="editingClass">'+m+"</select>";var p=batchData[batchTemplate].rooms,h="";for(var y in p)h+='<option value="'+y+'">'+p[y]+"</option>";i.innerHTML='<select class="custom-select" id="selectedRoom">'+h+"</select>"}else{console.log("deleting: "+t);var T=new XMLHttpRequest;T.onreadystatechange=function(){4==this.readyState&&200==this.status&&(timetableResultList.innerHTML=this.responseText)},confirm("Want to delete?")?(T.open("POST","handler_timetable.php",!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.send("action=deleteClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&deleteId="+t)):console.log("Deletion is stopped!")}}function updateLayout(e){"list"==(layout=e.target?e.target.value:selectedLayout.value)?(timetableOuter.classList.add("list"),timetableOuter.classList.remove("grid")):(timetableOuter.classList.add("grid"),timetableOuter.classList.remove("list"))}function orderClassBy(e){orderBy=e.target.dataset.orderBy,console.log("ordering by..."+orderBy),updateTimeTableList()}function init(){selectedDate.value=currentDate(),filterStartDate.value="2018-03-02",filterEndDate.value="2018-03-25",updateTimeTableList(selectedBatch),updateTimeTableGrid(),updateLayout(selectedLayout)}init(),selectedBatch.addEventListener("change",updateTimeTableList,!1),filterStartDate.addEventListener("change",updateTimeTableGrid,!1),filterEndDate.addEventListener("change",updateTimeTableGrid,!1),selectedLayout.addEventListener("change",updateLayout,!1),addClassBtn.addEventListener("click",addClass,!1),timetableResultList.addEventListener("click",individualClassEdit,!1);for(var orderByItems=document.querySelectorAll("[data-order-by]"),i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderClassBy,!1);