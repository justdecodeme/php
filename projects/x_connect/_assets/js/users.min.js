var orderByItems=document.querySelectorAll("[data-order-by]"),selectedTotal=document.getElementById("selectedTotal"),selectedBatch=document.getElementById("selectedBatch"),selectedRole=document.getElementById("selectedRole"),selectedGender=document.getElementById("selectedGender"),selectedDOJ=document.getElementById("selectedDOJ"),selectedSearch=document.getElementById("selectedSearch"),usersResultList=document.getElementById("usersResultList"),editingUserFlag=!1,batchCode=role=gender=null,orderBy="doj",ascOrDesc="ASC";function updateUsersList(){console.log("users list updating..."),editingUserFlag=!1,batchCode=selectedBatch.value,role=selectedRole.value,gender=selectedGender.value,doj=selectedDOJ.value,search=selectedSearch.value;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(usersResultList.innerHTML=this.responseText,selectedTotal.value=usersResultList.getElementsByTagName("tr").length)},e.open("GET","users_handler.php?action=updateUsersList&batchCode="+batchCode+"&role="+role+"&gender="+gender+"&orderBy="+orderBy+"&doj="+doj+"&search="+search+"&ascOrDesc="+ascOrDesc,!0),e.send()}function individualEdit(e){if(e.stopPropagation(),"delete"!=e.target.id||editingUserFlag)if("editUser"!=e.target.id||editingUserFlag){if("cancelUser"==e.target.id&&editingUserFlag){var t=e.target.dataset.classId;console.log("cancelling: "+t),updateTimeTableList()}else if("submitUser"==e.target.id&&editingUserFlag){var s=e.target.dataset.classId;console.log("submitting: "+s);var a=document.getElementById("editingDate").value,d=(h=document.getElementById("editingClass").value,B=document.getElementById("editingInstructors").value,document.getElementById("editingStartTime").value),r=document.getElementById("editingEndTime").value,n=(I=document.getElementById("editingRoom").value,new XMLHttpRequest);n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(usersResultList.innerHTML=this.responseText,editingUserFlag=!1)},n.open("POST","users_handler.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("action=submitClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+a+"&classCode="+h+"&instructorCode="+B+"&startTime="+d+"&endTime="+r+"&roomCode="+I+"&submitId="+s)}}else{var i=e.target.dataset.classId;console.log("editing: "+i),editingUserFlag=!0;var o=document.getElementById("editClass_"+i),l=o.querySelector(".edit-date"),c=o.querySelector(".edit-class"),u=o.querySelector(".edit-instructor"),g=o.querySelector(".edit-time"),m=o.querySelector(".edit-room");o.classList.add("editing-class"),l.innerHTML='<input type="date" class="form-control" id="editingDate" value="'+l.dataset.date+'">',g.classList.add("time-picker"),g.innerHTML='<input type="time" class="form-control" id="editingStartTime" value="'+g.dataset.starttime+'"><input type="time" class="form-control" id="editingEndTime" value="'+g.dataset.endtime+'">';var p=batchData[batchTemplate].classes,y="";for(var h in p)h==c.dataset.class?y+='<option value="'+h+'" selected>'+p[h]+"</option>":y+='<option value="'+h+'">'+p[h]+"</option>";c.innerHTML='<select class="custom-select" id="editingClass">'+y+"</select>";var v=batchData[batchTemplate].instructors,L="";for(var B in v)B==u.dataset.instructor?L+='<option value="'+B+'" selected>'+v[B]+"</option>":L+='<option value="'+B+'">'+v[B]+"</option>";u.innerHTML='<select class="custom-select" id="editingInstructors">'+L+"</select>";var T=batchData[batchTemplate].rooms,E="";for(var I in T)I==m.dataset.room?E+='<option value="'+I+'" selected>'+T[I]+"</option>":E+='<option value="'+I+'">'+T[I]+"</option>";m.innerHTML='<select class="custom-select" id="editingRoom">'+E+"</select>"}else{var C=e.target.dataset.id;console.log("deleting: "+C);var D=new XMLHttpRequest;D.onreadystatechange=function(){4==this.readyState&&200==this.status&&(usersResultList.innerHTML=this.responseText)},confirm("Want to delete?")?(D.open("POST","users_handler.php",!0),D.setRequestHeader("Content-type","application/x-www-form-urlencoded"),D.send("action=delete&batchCode="+batchCode+"&role="+role+"&gender="+gender+"&doj="+doj+"&deleteId="+C+"&search="+search+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0)):console.log("Deletion is stopped!")}}function orderUsersBy(e){for(var t=orderBy,s=0;s<orderByItems.length;s++)orderByItems[s].classList.remove("active-ASC"),orderByItems[s].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateUsersList()}function init(){updateUsersList()}init(),selectedBatch.addEventListener("change",updateUsersList,!1),selectedRole.addEventListener("change",updateUsersList,!1),selectedGender.addEventListener("change",updateUsersList,!1),selectedDOJ.addEventListener("change",updateUsersList,!1),selectedSearch.addEventListener("keyup",updateUsersList,!1),usersResultList.addEventListener("click",individualEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderUsersBy,!1);