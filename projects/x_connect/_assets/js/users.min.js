var orderByItems=document.querySelectorAll("[data-order-by]"),selectedTotal=document.getElementById("selectedTotal"),selectedBatch=document.getElementById("selectedBatch"),selectedRole=document.getElementById("selectedRole"),selectedGender=document.getElementById("selectedGender"),selectedDOJ=document.getElementById("selectedDOJ"),selectedSearch=document.getElementById("selectedSearch"),usersResultList=document.getElementById("usersResultList"),editingUserFlag=!1,batchCode=role=gender=null,orderBy="doj",ascOrDesc="ASC";function updateUsersList(){console.log("users list updating..."),editingUserFlag=!1,batchCode=selectedBatch.value,role=selectedRole.value,gender=selectedGender.value,doj=selectedDOJ.value,search=selectedSearch.value;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(usersResultList.innerHTML=this.responseText,selectedTotal.value=usersResultList.getElementsByTagName("tr").length)},e.open("GET","users_handler.php?action=updateUsersList&batchCode="+batchCode+"&role="+role+"&gender="+gender+"&orderBy="+orderBy+"&doj="+doj+"&search="+search+"&ascOrDesc="+ascOrDesc,!0),e.send()}function individualEdit(e){if(e.stopPropagation(),"delete"!=e.target.id||editingUserFlag)if("edit"!=e.target.id||editingUserFlag){if("cancel"==e.target.id&&editingUserFlag){var t=e.target.dataset.id;console.log("cancelling: "+t),updateUsersList()}else if("submit"==e.target.id&&editingUserFlag){var s=e.target.dataset.id;console.log("submitting: "+s);var d=document.getElementById("editingRole").value,r=(document.getElementById("editingStudentCode").value,new XMLHttpRequest);r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(usersResultList.innerHTML=this.responseText,editingUserFlag=!1)},r.open("POST","users_handler.php",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send("action=submitClass&batchCode="+batchCode+"&batchTemplate="+batchTemplate+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc+"&date="+date+"&classCode="+classCode+"&instructorCode="+instructorCode+"&startTime="+startTime+"&endTime="+endTime+"&roomCode="+roomCode+"&submitId="+s)}}else{var a=e.target.dataset.id;console.log("editing: "+a),editingUserFlag=!0;var n=document.getElementById("edit_"+a),o=n.querySelector(".edit-role"),i=n.querySelector(".edit-student-code");n.classList.add("editing-class"),i.innerHTML='<input type="text" class="form-control" id="editingStudentCode" value="'+i.dataset.studentCode+'">',o.innerHTML='\n      <select class="custom-select my-1" id="editingRole">\n        <option value="instructor">Instructor</option>\n        <option value="student">Students</option>\n        <option value="subscriber" selected>Subscriber</option>\n      </select>'}else{var l=e.target.dataset.id;console.log("deleting: "+l);var c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status?(usersResultList.innerHTML=this.responseText,selectedTotal.value=usersResultList.getElementsByTagName("tr").length):console.log(this.status)},confirm("Want to delete?")?(c.open("POST","users_handler.php",!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send("action=delete&batchCode="+batchCode+"&role="+d+"&gender="+gender+"&doj="+doj+"&deleteId="+l+"&search="+search+"&orderBy="+orderBy+"&ascOrDesc="+ascOrDesc,!0)):console.log("Deletion is stopped!")}}function orderUsersBy(e){for(var t=orderBy,s=0;s<orderByItems.length;s++)orderByItems[s].classList.remove("active-ASC"),orderByItems[s].classList.remove("active-DESC");orderBy=e.target.dataset.orderBy,ascOrDesc=t==orderBy?"DESC"==ascOrDesc?"ASC":"DESC":"ASC",e.target.classList.add("active-"+ascOrDesc),console.log("ordering by..."+orderBy,ascOrDesc),updateUsersList()}function init(){updateUsersList()}init(),selectedBatch.addEventListener("change",updateUsersList,!1),selectedRole.addEventListener("change",updateUsersList,!1),selectedGender.addEventListener("change",updateUsersList,!1),selectedDOJ.addEventListener("change",updateUsersList,!1),selectedSearch.addEventListener("keyup",updateUsersList,!1),usersResultList.addEventListener("click",individualEdit,!1);for(var i=0;i<orderByItems.length;i++)orderByItems[i].addEventListener("click",orderUsersBy,!1);