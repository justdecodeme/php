!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(this,function(t){"use strict";var e='<li><div class="layout"><label>No results.</label></div></li>',i=function(e,s){t(e).html('    <button class="dropdown-checkbox-toggle" data-toggle="dropdown" href="#">Dropdown trigger </button>    <div class="dropdown-checkbox-content">      <div class="dropdown-checkbox-header">        <input class="checkbox-all" type="checkbox"><input type="text" placeholder="Search" class="search"/>      </div>      <ul class="dropdown-checkbox-menu"></ul>    </div>'),t(e).addClass("dropdown-checkbox dropdown"),this.$element=t(e).find(".dropdown-checkbox-toggle"),this.$parent=t(e),this.$list=this.$parent.find("ul"),this.data=[],this.hasChanges=!1,this.showNbSelected=!1,this.maxItems=!1,this.alternate=!1,"object"==typeof s&&(this.$element.text(s.title),this.$element.addClass(s.btnClass),this.autosearch=s.autosearch,this.data=s.data||[],this._sort=s.sort||this._sort,this.sortOptions=s.sortOptions,this.hideHeader=!(!s.hideHeader&&void 0!==s.hideHeader),this.templateButton=s.templateButton,this.showNbSelected=s.showNbSelected||!1,this.maxItems=s.maxItems||!1,this._query=s.query||this._query,this._queryMethod=s.httpMethod||"GET",this._queryParse=s.queryParse||this._queryParse,this._queryError=s.queryError||function(){},this._queryUrl=s.queryUrl,this.templateMaxResults=s.templateMaxResults||"Showing {limit} of {total} items<br>Use search to filter your results.",this.alternate=!!s.alternate),this.showNbSelected&&this.$element.append(' <span class="dropdown-checkbox-nbselected"></span>'),this.templateButton&&(this.$element.remove(),this.$parent.prepend(this.templateButton),this.$element=this.$parent.find(".dropdown-checkbox-toggle")),this.$element.attr("data-toggle","dropdown"),this.hideHeader&&this.$parent.find(".dropdown-checkbox-header").remove(),this.$parent.find(".dropdown-checkbox-content").on("click.dropdown-checkbox.data-api",function(t){t.stopPropagation()}),this.$element.on("click.dropdown-checkbox.data-api",t.proxy(function(){var e=this.$parent.hasClass("open");return t(".dropdown").removeClass("open"),e&&this.$parent.addClass("open"),this.$parent.toggleClass("open"),this.hasChanges&&this.$parent.trigger("change:dropdown-checkbox"),this.hasChanges=!1,!1},this)),this.$parent.find(".checkbox-all").on("change.dropdown-checkbox.data-api",t.proxy(function(t){this.onChangeCheckboxAll(t),this._showNbSelected()},this)),t(document).on("click.dropdown-checkbox.data-api",t.proxy(function(){this.$parent.removeClass("open"),this.hasChanges&&this.$parent.trigger("change:dropdown-checkbox"),this.hasChanges=!1},this)),this.$parent.find(".dropdown-checkbox-header").on("keyup.dropdown-checkbox.data-api",t.proxy(i.prototype.onKeyup,this)),this.$parent.find("ul").delegate("li input[type=checkbox]","change.dropdown-checkbox.data-api",t.proxy(function(t){this.onChangeCheckbox(t),this._showNbSelected()},this)),this._reset(this.data),this._showNbSelected(),this._refreshCheckboxAll()};i.prototype={constructor:i,_sort:function(t){return t},_query:function(e,i,s,h){return t.ajax({type:e,url:i+"?q="+this.word,dataType:"json",cache:!1,contentType:"application/json",success:t.proxy(s,this),error:h})},_querySuccess:function(t){var i=this._queryParse(t);return i.length>0?this._reset(i):this.$list.html(e)},_queryParse:function(t){return t},_removeElements:function(t){this._isValidArray(t);for(var e=[],i=!0,s=0;s<this.data.length;s++){for(var h=0;h<t.length;h++)t[h]===parseInt(this.data[s].id,10)&&(i=!1);i&&e.push(this.data[s]),i=!0}return this.data=e,this},_getCheckbox:function(t,e){for(var i=[],s=0;s<this.data.length;s++)(t===this.data[s].isChecked||e)&&i.push(this.data[s]);return i},_isValidArray:function(e){if(!t.isArray(e))throw"[DropdownCheckbox] Requires array."},_findMatch:function(t,e){for(var i=[],s=0;s<e.length;s++)-1!==e[s].label.toLowerCase().search(t.toLowerCase())&&i.push(e[s]);return i},_findById:function(t){for(var e=0;e<this.data.length;e++)if(t===this.data[e].id)return this.data[e];return null},_setCheckbox:function(t,e){var i=this._findById(e);i&&(i.isChecked=t)},_isDataItemChecked:function(t){return!!t.isChecked},_anyChecked:function(){return this.data.some(this._isDataItemChecked)},_allChecked:function(){return this.data.every(this._isDataItemChecked)},_noneChecked:function(){return!this._anyChecked()},_checkedLength:function(){return this.data.filter(this._isDataItemChecked).length},_refreshCheckboxAll:function(){var t=this._anyChecked();this.alternate&&(t=!(!this._allChecked()&&!this._noneChecked())||!this._anyChecked()),this.$element.parents(".dropdown-checkbox").find(".checkbox-all").prop("checked",t)},_resetSearch:function(){return this.$parent.find(".search").val(""),this._reset(this.data),this},_createListItem:function(e){var i=e.id,s=e.label,h=e.isChecked,n=(new Date).getTime()*Math.random(),a=this._allChecked(),r=this.listItemPrototype.cloneNode(!0),o=r.firstChild;return t(r).data("id",i),o.firstChild.id=n,o.firstChild.checked=(!this.alternate||!a)&&h,o.lastChild.textContent=s,o.lastChild.setAttribute("for",n),r},_appendOne:function(t){return this.$list.append(this._createListItem(t)),this},_refresh:function(){},_append:function(e){this.listItemPrototype||(this.listItemPrototype=t('<li><div class="layout"><input type="checkbox"/><label></label></div></li>')[0]),t.isArray(e)||(e=[e]);var i,s=this.maxItems?Math.min(this.maxItems,e.length):e.length,h=e.length-this.maxItems,n=this.maxItems,a=this.templateMaxResults,r=this._createListItem.bind(this),o=this.$list,c=this.$parent.find(".dropdown-checkbox-content");return e=this._sort(e,this.sortOptions),function t(d){var l,p,u,f,k=document.createDocumentFragment();for(i=d;i<Math.min(d+100,s);i++)k.appendChild(r(e[i]));o[0].appendChild(k),i<s?(f=t.bind(null,i),window.requestAnimationFrame?window.requestAnimationFrame(f):setTimeout(f,0)):h>0&&n&&c.append((l=a,p=n,u=e.length,('<div class="alert maxitems">'+l+"</div>").replace("{limit}",p).replace("{total}",u)))}(0),this._showNbSelected(),this},_reset:function(t){return this.alternate&&this._noneChecked()&&this.data.forEach(function(t){t.isChecked=!0}),this._isValidArray(t),this.$parent.find(".maxitems").remove(),this.$list.empty(),this._append(this._sort(t)),this._refreshCheckboxAll(),this},_showNbSelected:function(){if(this.showNbSelected)return this.$element.find(".dropdown-checkbox-nbselected").html("("+this._checkedLength()+")"),this},onKeyup:function(i){var s=i.keyCode,h=this.word=t(i.target).val();if(h.length<1&&8===s)return this.$parent.find(".checkbox-all").show(),this._reset(this.data);if(27===s)return this.$parent.find(".checkbox-all").show(),this._resetSearch();if(this.alternate&&this.$parent.find(".checkbox-all").hide(),this.autosearch||13===s){if(!this._queryUrl){var n=this._findMatch(h,this.data);return n.length>0?this._reset(n):this.$list.html(e)}this._query(this._queryMethod,this._queryUrl,this._querySuccess,this._queryError)}},onChangeCheckboxAll:function(e){var i=t(e.target).is(":checked"),s=this.alternate,h=this.$parent.find("ul li"),n=this,a=i,r=i;s&&(i?(a=!1,r=!0):(a=!1,r=!1)),h.each(function(){t(this).find("input[type=checkbox]").prop("checked",a),n._setCheckbox(r,t(this).data("id"))}),s&&i&&this.data.forEach(function(t){t.isChecked=!0}),this.$parent.trigger("checked:all",i),i?this.$parent.trigger("check:all"):this.$parent.trigger("uncheck:all"),s&&!1===r&&(this.data.forEach(function(t){t.isChecked=!1}),h.first().each(function(){t(this).find("input[type=checkbox]").prop("checked",!0),n._setCheckbox(!0,t(this).data("id"))})),this.hasChanges=!0},onChangeCheckbox:function(e){var i=t(e.target).prop("checked"),s=t(e.target).parent().parent().data("id");this.alternate&&this._allChecked()&&i?(this.data.forEach(function(t){t.isChecked=!1}),this._setCheckbox(!0,s)):this.alternate&&1===this._checkedLength()&&!i?(this.data.forEach(function(t){t.isChecked=!0}),this._setCheckbox(!0,s)):this._setCheckbox(i,s),this._refreshCheckboxAll(),this.$parent.trigger("checked",i),i?this.$parent.trigger("check:checkbox"):this.$parent.trigger("uncheck:checkbox"),this.hasChanges=!0},checked:function(){return this._getCheckbox(!0)},unchecked:function(){return this._getCheckbox(!1)},items:function(){return this._getCheckbox(void 0,!0)},append:function(e){if(t.isArray(e))for(var i=0;i<e.length;i++)this.data.push(e[i]);else this.data.push(e);e=this._sort(e),this._append(e),this.hasChanges=!0},remove:function(e){t.isArray(e)||(e=[e]),this._isValidArray(e),this._removeElements(e),this._reset(this.data),this.hasChanges=!0},reset:function(e){t.isArray(e)?this.data=e:this.data=[e],this._reset(e),this.hasChanges=!0}},t.fn.dropdownCheckbox=function(e,s){var h=t(this),n=h.data("dropdownCheckbox"),a="object"==typeof e&&e;return n||h.data("dropdownCheckbox",n=new i(this,a)),"string"==typeof e?n[e](s):this},t.fn.dropdownCheckbox.Constructor=i});